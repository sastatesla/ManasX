# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Commands

### Development
- `npm run manasx <command> <file>` - Run the CLI tool locally during development
- `node src/cli/index.js <command> <file>` - Alternative way to run CLI directly

### Enterprise Governance Commands (NEW)
- `manasx learn [directory]` - Learn patterns from existing codebase
- `manasx drift <files...>` - Check for pattern drift in files
- `manasx compliance [directory]` - Run full compliance check
- `manasx rules init` - Initialize organizational rule configuration
- `manasx rules validate` - Validate rule configuration
- `manasx ai-audit <files...>` - Audit AI-generated code
- `manasx ai-detect <files...>` - Detect AI-generated code patterns

### Continuous Monitoring (CORE FEATURE)
- `manasx watch [directory]` - **Start continuous monitoring for real-time governance**
- `manasx status` - Show monitoring status and recent activity

**The `watch` command is the core feature - it runs continuously and feeds insights to AI coding tools like Claude Code CLI and Cursor via MCP (Model Context Protocol).**

### Legacy Analysis Commands
- `manasx perf <file>` - Analyze a JavaScript/TypeScript file for performance issues
- `manasx debug <file>` - Analyze a file for best practices and debugging suggestions  

### Code Quality
- `npx eslint <file>` - Run ESLint on specific files
- `npx eslint .` - Run ESLint on entire project

### Testing
Note: Tests are not currently configured (`npm test` returns an error). Use Jest framework if implementing tests.

## Architecture Overview

**ManasX has been transformed from a general performance analysis tool into an enterprise code governance and AI audit platform.**

### NEW: Enterprise Governance Architecture
The tool now focuses on organizational code standards enforcement and AI-generated code auditing:

#### 1. Pattern Learning & Drift Detection (`src/governance/`)
- **PatternLearner.js** - Learns established patterns from existing codebase (naming, architecture, imports, testing)
- **DriftDetector.js** - Detects when new code deviates from learned organizational patterns
- **RuleEngine.js** - Manages and enforces organizational coding rules and standards

#### 2. AI Code Auditing (`src/ai-audit/`)
- **AIDetector.js** - Identifies code patterns likely generated by AI assistants (Claude, GPT, Copilot)
- **AIAuditor.js** - Specialized auditing rules for AI-generated code (requires human review, unit tests, etc.)

#### 3. Enterprise Governance Workflow
1. **Learn Phase**: Analyze existing codebase to establish organizational patterns
2. **Rule Configuration**: Define organization-specific rules in `manasx-rules.json`
3. **Continuous Monitoring**: Check new code for drift from established patterns
4. **AI Code Governance**: Detect and audit AI-generated code against enterprise standards
5. **Compliance Reporting**: Generate compliance reports for management visibility

### Legacy Architecture (Still Supported)
- **Entry Point**: `bin/agentic.js` - Handles GROQ API key setup and bootstraps the CLI
- **CLI Interface**: `src/cli/index.js` - Commander.js-based CLI with governance and legacy commands
- **Main Logic**: `src/index.js` - Exports both new governance and legacy analysis functions

#### Legacy Agent System
- **PerformanceAgent** (`src/agents/PerformanceAgent.js`) - Analyzes performance metrics and issues
- **DebuggingAgent** (`src/agents/DebuggingAgent.js`) - Analyzes best practices and debugging issues

#### Legacy Analysis Pipeline
- **Static Analyzers** (`src/analysis/`) - PerformanceAnalyzer.js and BestPracticeAnalyzer.js
- **AI Model Integration** (`src/utils/AiModel.js`) - GROQ API interface
- **Suggestion System** (`src/suggestions/`) - Transforms analysis results into suggestions

### Configuration Files
- **NEW**: `manasx-rules.json` - Organizational rule configuration (security, performance, architecture, naming)
- **NEW**: `patterns.json` - Learned codebase patterns (generated by `manasx learn`)
- **ESLint**: `eslint.config.mjs` - Uses @eslint/js and @eslint/json plugins
- **API Key**: Stored in `~/.manasxrc` or `GROQ_API_KEY` environment variable

### Updated Module Structure
```
src/
├── governance/      # NEW: Enterprise governance (PatternLearner, DriftDetector, RuleEngine)
├── ai-audit/       # NEW: AI code detection and auditing (AIDetector, AIAuditor)
├── agents/         # Legacy: Analysis agents (Performance, Debugging)
├── analysis/       # Legacy: Core analyzers (Performance, BestPractice)
├── cli/           # Updated: Command-line interface with governance commands
├── suggestions/   # Legacy: Suggestion generation
└── utils/         # Utilities (AI model, logger)
```

### Enterprise Governance Flow
1. **Pattern Learning**: `manasx learn` analyzes existing codebase and saves patterns
2. **Rule Setup**: `manasx rules init` creates organizational rule configuration
3. **Drift Detection**: `manasx drift` checks new code against learned patterns
4. **Compliance Check**: `manasx compliance` runs full organizational rule validation
5. **AI Auditing**: `manasx ai-audit` detects and audits AI-generated code
6. **Continuous Integration**: Integrate with CI/CD for automated governance

### Key Value Propositions
- **AI Drift Detection**: Automatically learns and enforces organizational patterns
- **Contextual Rules**: Organization-specific rules (e.g., "use company fetch wrapper")
- **AI Code Governance**: Specialized auditing for AI-generated code
- **Pattern-Based**: Learns from existing codebase instead of generic rules
- **Enterprise-Focused**: Built for organizations with established coding standards